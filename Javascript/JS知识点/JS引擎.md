进度：资料看了一遍，待深入学习整理

# 资料

[深入理解 JavaScript 引擎](https://cloud.tencent.com/developer/article/1884087)

[JavaScript 引擎的工作原理：代码解析与执行](https://segmentfault.com/a/1190000043998037)

[V8 团队的一个错误，使得整个互联网变慢](https://zhuanlan.zhihu.com/p/29790641)

## JavaScript 引擎

常见的 JavaScript 引擎包括：

- V8 引擎：由 Google 开发，用于 Google Chrome 浏览器和 Node.js 服务器环境。
- SpiderMonkey 引擎：由 Mozilla 开发，用于 Mozilla Firefox 浏览器。
- JavaScriptCore 引擎：由苹果公司开发，用于 Safari 浏览器。
- Chakra 引擎：由微软开发，用于 Microsoft Edge 浏览器。

## JavaScript 代码的执行过程

JavaScript 代码的执行过程可以分为三个阶段：

- 解析（Parsing）
  - 将源代码转换为抽象语法树（Abstract Syntax Tree，简称 AST）。
  - 解析器（Parser）负责执行解析过程（词法分析、语法分析）。
- 编译（Compilation）
  - 将抽象语法树转换为可执行的字节码或机器码。
  - 编译器的主要任务包括：对抽象语法树进行优化；生成字节码或机器码
- 执行（Execution）
  - 执行引擎会逐行执行字节码或机器码，并将结果输出到控制台或更新浏览器中的页面。
  - 执行引擎的主要任务包括：解释执行、处理数据、处理控制流

编译阶段指 V8 将 JavaScript 转换为字节码或者二进制机器码，

执行阶段指解释器解释执行字节码，或者 CPU 直接执行二进制机器码。

## 逃逸分析

escape analysis 学名是逃逸分析。在编译优化理论中，逃逸分析是一种确定指针动态范围的方法——分析在程序的哪些地方可以访问到指针。

在 JavaScript 中，分析函数调用关系，以判断变量是否“逃逸”出当前作用域范围。如果从当前函数外部可访问某个对象，则这个分配的对象"逃逸(escape)"了。

V8 在 JavaScript 堆上分配新对象，使用逃逸分析，当 V8 分析出此对象只在函数内部起作用（和函数有相同的生命周期），则 V8 可以把对象分配到栈上，甚至可以把某些变量分配到寄存器中，把对象作为一个简单的局部变量。如果对象逃逸了，则必须在堆上分配。

# 概念

## 机器码

机器码(machine code)，学名机器语言指令，有时也被称为原生码（Native Code），是电脑的 CPU 可直接解读的数据(计算机只认识 0 和 1)。

通常意义上来理解的话，机器码就是计算机可以直接执行，并且执行速度最快的代码。

## 字节码

字节码通常指的是已经经过编译，但与特定机器码无关，需要直译器转译后才能成为机器码的中间代码。字节码通常不像源码一样可以让人阅读，而是编码后的数值常量、引用、指令等构成的序列。

字节码主要为了实现特定软件运行和软件环境、硬件环境无关。字节码的实现方式是通过编译器和虚拟机器。编译器将源码编译成字节码，特定平台上的虚拟机器将字节码转译为可以直接执行的指令。字节码的典型应用为 Java 语言。

Java 作为一款“一次编译，到处运行”的编程语言，跨平台靠的是 JVM 实现对不同操作系统 API 的支持，而一次编译指的就是 class 字节码；即我们编写好的.java 文件，通过编译器编译成.class 文件，JVM 负责加载解释字节码文件，并生成系统可识别的代码执行(具体解析本次不做深入研究).

查看 js 生成的字节码

```shell
node --print-bytecode index.js
```

## 寄存器

寄存器（register）是 CPU（中央处理器）的组成部分，是一种直接整合到 cpu 中的有限的高速访问速度的存储器，它是由一些与非门组合组成的，分为通用寄存器和特殊寄存器。

cpu 访问寄存器的速度是最快的，但是非常小，是一种容量有限的存储器。因此只把一些计算机的指令等一些计算机频繁用到的数据存储在其中，来提高计算机的运行速度。
